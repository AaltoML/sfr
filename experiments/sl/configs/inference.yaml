defaults:
  # Use slurm on cluster or local?
  # - override hydra/launcher: submitit_local
  # - override hydra/launcher: local
  - override hydra/launcher: lumi
  # - override hydra/launcher: slurm
  # - override hydra/launcher: slurm_cpu
  # Disable logging by Hydra
  # - override hydra/job_logging: none
  - override hydra/hydra_logging: none
  - _self_

# dataset: "FMNIST"
# dataset: "CIFAR10"
# model_name: "CNN"

dataset: "FMNIST"
model_name: "CNN"
# checkpoint: "./saved_models/FMNIST_CNN_117_1.0e-04.pt"
checkpoint: "./wandb/run-20230516_223936-fcu9vg8r/files/saved_models/FMNIST_CNN_117_3.0e-03.pt"

subset_of_weights: "all"
hessian_structure: "diag"

device: ???
output_dim: ???
batch_size: 512
lr: 1e-4
n_epochs: 500
# n_epochs: 1
# double: True
double: True

debug: False
num_inducing: 1000
predictive_model: sfr

# num_workers: 8
# num_workers: 1

logging_epoch_freq: 10
random_seed: 117

sfr:
  _target_: src.sfr.SFR
  _convert_: all
  # network: ???
  # prior: ???
  likelihood: ${likelihood}
  output_dim: ${output_dim}
  num_inducing: ${num_inducing}
  dual_batch_size: 1000
  jitter: 1e-4
  device: ${device} # TODO should this always be cpu??

gp_subset:
  _target_: src.nn2gp.NN2GPSubset
  _convert_: all
  # network: ???
  # prior: ???
  likelihood: ${likelihood}
  output_dim: ${output_dim}
  subset_size: ${num_inducing}
  dual_batch_size: 1000
  jitter: 1e-4
  device: ${device} # TODO should this always be cpu??

prior:
  _target_: src.priors.Gaussian
  # params: ???
  delta: ???

likelihood:
  _target_: src.likelihoods.CategoricalLh
  EPS: 0.0

# network:
#   _target_: src.sl.train.get_model
#   model_name: "CNN"
#   ds_train: ${dataset}

# dataset_name:
# dataset:
#   _target_: src.sl.train.get_dataset
#   dataset: "FMNIST"
#   double: ${double}
#   device: ${device}

wandb:
  group: ${dataset}
  entity: "" # dropped for anonymity, replace with your own
  project: "sfr-sl-inference"
  use_wandb: True
  run_name: delta=${prior.delta}-lr=${lr}-seed=${random_seed}-${now:%Y-%m-%d_%H-%M-%S}
  # run_name: ${alg_name}-${online_update_freq}-${agent.horizon}-${random_seed}-${now:%Y-%m-%d_%H-%M-%S}
  tags:
    - "delta=${prior.delta}"
    - "m=${sfr.num_inducing}"
    - "dataset=${dataset}"
  #   - "env=${env.env_name}-${env.task_name}"
  #   - "alg=${alg_name}"
  #   - "online_update_freq=${online_update_freq}"

hydra:
  job:
    chdir: False
  run:
    dir: ""
